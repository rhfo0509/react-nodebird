{"version":3,"file":"static/chunks/pages/index-3fdf9018fd28dd83.js","mappings":"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","sources":["webpack://_N_E/./node_modules/next/dist/compiled/@babel/runtime/helpers/esm/toConsumableArray.js","webpack://_N_E/./node_modules/next/dist/compiled/@babel/runtime/helpers/esm/arrayWithoutHoles.js","webpack://_N_E/./node_modules/next/dist/compiled/@babel/runtime/helpers/esm/iterableToArray.js","webpack://_N_E/./node_modules/next/dist/compiled/@babel/runtime/helpers/esm/nonIterableSpread.js","webpack://_N_E/./components/PostForm.js","webpack://_N_E/./pages/index.js","webpack://_N_E/"],"sourcesContent":["import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import React, { useCallback, useEffect, useRef } from \"react\";\nimport { Button, Form, Input } from \"antd\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport {\n  UPLOAD_IMAGES_REQUEST,\n  REMOVE_IMAGE,\n  ADD_POST_REQUEST,\n} from \"../reducers/post\";\nimport useInput from \"../hooks/useInput\";\n\nconst PostForm = () => {\n  const { imagePaths, addPostDone } = useSelector((state) => state.post);\n  const dispatch = useDispatch();\n\n  const [text, onChangeText, setText] = useInput(\"\");\n\n  useEffect(() => {\n    if (addPostDone) {\n      setText(\"\");\n    }\n  }, [addPostDone]);\n\n  const onSubmit = useCallback(() => {\n    if (!text || !text.trim()) {\n      return alert(\"게시글을 작성하세요.\");\n    }\n    const formData = new FormData();\n    imagePaths.forEach((p) => {\n      formData.append(\"image\", p);\n    });\n    formData.append(\"content\", text);\n    dispatch({\n      type: ADD_POST_REQUEST,\n      data: formData,\n    });\n  }, [text, imagePaths]);\n\n  const imageInput = useRef();\n  const onClickImageUpload = useCallback(() => {\n    imageInput.current.click();\n  }, [imageInput.current]);\n\n  const onChangeImages = useCallback((e) => {\n    console.log(\"images\", e.target.files);\n    const formData = new FormData();\n    [...e.target.files].forEach((f) => {\n      formData.append(\"image\", f);\n    });\n    dispatch({ type: UPLOAD_IMAGES_REQUEST, data: formData });\n  }, []);\n\n  const onRemoveImage = useCallback(\n    (index) => () => {\n      dispatch({ type: REMOVE_IMAGE, data: index });\n    },\n    []\n  );\n\n  return (\n    <Form\n      style={{ margin: \"10px 0 20px\" }}\n      encType=\"multipart/form-data\"\n      onFinish={onSubmit}\n    >\n      <Input.TextArea\n        value={text}\n        onChange={onChangeText}\n        maxLength={140}\n        placeholder=\"어떤 신기한 일이 있었나요?\"\n      />\n      <div>\n        <input\n          type=\"file\"\n          name=\"image\"\n          multiple\n          hidden\n          ref={imageInput}\n          onChange={onChangeImages}\n        />\n        <Button onClick={onClickImageUpload}>이미지 업로드</Button>\n        <Button type=\"primary\" style={{ float: \"right\" }} htmlType=\"submit\">\n          짹짹\n        </Button>\n      </div>\n      <div>\n        {imagePaths.map((v, i) => (\n          <div key={v} style={{ display: \"inline-block\" }}>\n            <img\n              src={v.replace(/\\/thumb\\//, \"/original/\")}\n              style={{ width: \"200px\" }}\n              alt={v}\n            />\n            <div>\n              <Button onClick={onRemoveImage(i)}>제거</Button>\n            </div>\n          </div>\n        ))}\n      </div>\n    </Form>\n  );\n};\n\nexport default PostForm;\n","import React, { useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { END } from \"redux-saga\";\nimport axios from \"axios\";\nimport wrapper from \"../store/configureStore\";\n\nimport AppLayout from \"../components/AppLayout\";\nimport PostForm from \"../components/PostForm\";\nimport PostCard from \"../components/PostCard\";\nimport { LOAD_POSTS_REQUEST } from \"../reducers/post\";\nimport { LOAD_MY_INFO_REQUEST } from \"../reducers/user\";\n\nconst Home = () => {\n  const dispatch = useDispatch();\n  const { mainPosts, hasMorePosts, loadPostsLoading, retweetError } =\n    useSelector((state) => state.post);\n  const { me } = useSelector((state) => state.user);\n\n  useEffect(() => {\n    if (retweetError) {\n      alert(retweetError);\n    }\n  }, [retweetError]);\n\n  useEffect(() => {\n    const onScroll = () => {\n      if (\n        window.scrollY + document.documentElement.clientHeight >\n        document.documentElement.scrollHeight - 300\n      ) {\n        if (hasMorePosts && !loadPostsLoading) {\n          const lastId = mainPosts[mainPosts.length - 1]?.id;\n          dispatch({\n            type: LOAD_POSTS_REQUEST,\n            lastId,\n          });\n        }\n      }\n    };\n    window.addEventListener(\"scroll\", onScroll);\n    return () => {\n      window.removeEventListener(\"scroll\", onScroll);\n    };\n  }, [mainPosts.length, hasMorePosts, loadPostsLoading]);\n  return (\n    <AppLayout>\n      {me && <PostForm />}\n      {mainPosts.map((post) => (\n        <PostCard key={post.id} post={post} />\n      ))}\n    </AppLayout>\n  );\n};\n\nexport const getServerSideProps = wrapper.getServerSideProps(\n  (store) =>\n    async ({ req }) => {\n      const cookie = req ? req.headers.cookie : \"\";\n      axios.defaults.headers.Cookie = \"\";\n      if (req && cookie) {\n        axios.defaults.headers.Cookie = cookie;\n      }\n      store.dispatch({ type: LOAD_MY_INFO_REQUEST });\n      store.dispatch({ type: LOAD_POSTS_REQUEST });\n      store.dispatch(END);\n      await store.sagaTask.toPromise();\n    }\n);\nexport default Home;\n","\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/\",\n      function () {\n        return require(\"private-next-pages/index.js\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/\"])\n      });\n    }\n  "],"names":["_toConsumableArray","arr","Array","isArray","arrayLikeToArray","iter","Symbol","iterator","from","unsupportedIterableToArray","TypeError","useSelector","state","post","imagePaths","addPostDone","dispatch","useDispatch","useInput","text","onChangeText","setText","useEffect","onSubmit","useCallback","trim","alert","formData","FormData","forEach","p","append","type","ADD_POST_REQUEST","data","imageInput","useRef","onClickImageUpload","current","click","onChangeImages","e","console","log","target","files","f","UPLOAD_IMAGES_REQUEST","onRemoveImage","index","REMOVE_IMAGE","style","margin","encType","onFinish","value","onChange","maxLength","placeholder","name","multiple","hidden","ref","onClick","float","htmlType","map","v","i","display","src","replace","width","alt","mainPosts","hasMorePosts","loadPostsLoading","retweetError","me","user","onScroll","window","scrollY","document","documentElement","clientHeight","scrollHeight","lastId","length","id","LOAD_POSTS_REQUEST","addEventListener","removeEventListener","AppLayout","PostCard","__NEXT_P","push"],"sourceRoot":""}